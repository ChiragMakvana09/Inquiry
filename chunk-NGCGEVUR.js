import{a as P,b as le}from"./chunk-GL5CNTKD.js";import{a as T,b as re,c as oe}from"./chunk-V7EBA6X5.js";import{$ as ee,A as q,B as G,D as C,E as H,G as $,H as U,I as W,K as z,O as J,V as K,X as Q,Y as X,Z,a as O,aa as te,ba as ae,fa as ie,ga as ne,i as Y,q as R,s as j,z as x}from"./chunk-4HOK7LM6.js";import{Cb as m,Lb as i,Mb as n,Nb as A,Rb as F,Tb as S,Ub as f,Xc as k,a as E,ad as N,b as B,bb as a,cb as v,dc as r,ec as c,fc as u,gc as w,gd as V,h as I,nb as M,oa as g,pa as b,ub as D,vc as p,xc as L,yc as h}from"./chunk-HV3O5WE3.js";function se(d,o){if(d&1&&(i(0,"tr",26)(1,"th",27),r(2),n(),i(3,"th",27),r(4),n(),i(5,"th",28),r(6),n(),i(7,"th",28),r(8),n(),i(9,"th",28),r(10),n()(),i(11,"tr",29)(12,"th",30)(13,"div"),r(14),n(),i(15,"div"),r(16),n()(),i(17,"th",31)(18,"div",32)(19,"span",33),r(20),n(),r(21,"/"),i(22,"span",34),r(23),n()(),i(24,"div",32),r(25),n()()()),d&2){let e=f(2);a(2),c(e.languageLabels.Date),a(2),c(e.languageLabels.Remarks),a(2),c(e.languageLabels.Credit),a(2),c(e.languageLabels.Debit),a(2),u(" ",e.languageLabels.Balance," "),a(4),c(e.languageLabels.Date),a(2),c(e.languageLabels.Remarks),a(4),c(e.languageLabels.Credit),a(3),c(e.languageLabels.Debit),a(2),c(e.languageLabels.Balance)}}function ce(d,o){if(d&1&&(i(0,"div",38),r(1),p(2,"dynamicDecimal"),n()),d&2){let e=f().$implicit,t=f(2);a(),u(" ",h(2,1,e.cr_amount,t.decimalPoints,t.comaSaprator)," ")}}function pe(d,o){if(d&1&&(i(0,"div",39),r(1),p(2,"dynamicDecimal"),n()),d&2){let e=f().$implicit,t=f(2);a(),u(" ",h(2,1,e.dr_amount,t.decimalPoints,t.comaSaprator)," ")}}function me(d,o){if(d&1&&(i(0,"tr",26)(1,"td",27),r(2),p(3,"date"),n(),i(4,"td",27),r(5),n(),i(6,"td",28),r(7),p(8,"dynamicDecimal"),n(),i(9,"td",28),r(10),p(11,"dynamicDecimal"),n(),i(12,"td",28),r(13),p(14,"dynamicDecimal"),n()(),i(15,"tr",29)(16,"td",30)(17,"div"),r(18),p(19,"date"),n(),i(20,"div"),r(21),n()(),i(22,"td",31),D(23,ce,3,5,"div",35)(24,pe,3,5,"div",36),i(25,"div",37),r(26),p(27,"dynamicDecimal"),n()()()),d&2){let e=o.$implicit,t=f(2);a(2),c(L(3,12,e.date1,"dd-MM-yyyy")),a(3),c(e.remarks),a(2),u(" ",e.cr_amount>0?h(8,15,e.cr_amount,t.decimalPoints,t.comaSaprator):""," "),a(3),u(" ",e.dr_amount>0?h(11,19,e.dr_amount,t.decimalPoints,t.comaSaprator):""," "),a(3),w(" ",h(14,23,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),t.decimalPoints,t.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," "),a(5),c(L(19,27,e.date1,"dd-MM-yyyy")),a(3),c(e.remarks),a(2),m("ngIf",e.cr_amount!=0),a(),m("ngIf",e.dr_amount!=0),a(2),w(" ",h(27,30,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),t.decimalPoints,t.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," ")}}function ue(d,o){if(d&1&&(i(0,"p-card",22)(1,"p-table",23,2),D(3,se,26,10,"ng-template",24)(4,me,28,34,"ng-template",25),n()()),d&2){let e=f();a(),m("value",e.trData)("scrollDirection","vertical")("scrollable",!0)}}var de=class d{constructor(o,e,t,l,s,_,y){this._fb=o;this.http=e;this.route=t;this.api=l;this.ps=s;this.location=_;this.cryptoUrl=y;this.languageLabelData=le}userData;shareForm;comaSaprator;decimalPoints;maxDate;minDate;endDateMinDate;urlProduct;urlAccId;urlBusinessNumber;urlBusinessCode;cifId;cifMobile;productMap={1002:"Share",1003:"Savings",1005:"FD",1006:"RD",1007:"Loan"};accountList=[];accountDisplayLabel="";selectedAccount=[];trData=[];opBalance=0;showTable=!1;currentLanguage;languageLabelData;languageLabels={};ngOnInit(){return I(this,null,function*(){this.createSavingsForm(),this.setEnvLanguage();let o=localStorage.getItem("ledger_client_id");o||(o=crypto.randomUUID(),localStorage.setItem("ledger_client_id",o)),this.route.queryParams.subscribe(e=>I(this,null,function*(){let t=e.t;if(!t){alert("Invalid or missing link");return}let s=yield this.cryptoUrl.decryptToken(t,"69f10c10568abe88bf8374203375a4b6");if(this.cifId=s.cif_id,this.cifMobile=s.cif_mobile,this.urlProduct=Number(s.product),this.urlBusinessNumber=s.businessNumber,this.urlBusinessCode=s.business_code,!this.cifId||!this.urlProduct||!this.urlBusinessNumber||!this.urlBusinessCode){alert("Invalid decrypted data");return}this.validateLedgerAccess(s.token)}))})}validateLedgerAccess(o){let e=localStorage.getItem("ledger_client_id");if(!e){alert("Invalid session");return}this.http.get("http://localhost:8800/whatsAppDemo/api/ledger/validate",{params:{token:o,client_id:e}}).subscribe({next:()=>{this.fetchProductAccounts()},error:t=>{let l=t.error?.reason;alert(l==="expired"?"\u23F1 Link expired. Please open again from WhatsApp.":l==="link_already_used"?"\u274C This link was already used.":"\u274C Invalid link")}})}fetchProductAccounts(){let o={business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"productBalance",cif_mobile:this.cifMobile,cif_id:this.cifId,product:this.urlProduct};this.api.post(T.TRANSCATION,o).subscribe(e=>{let t=e?.payload?.data?.balanceData?.data||e?.data?.balanceData?.data||[];this.accountList=t.map(l=>B(E({},l),{label:`${l.account_no} - ${l.product_name}`}))})}onAccountChange(o){this.urlAccId=o,this.selectedAccount=this.accountList.find(e=>e.id===o)||{},this.accountDisplayLabel=this.selectedAccount.label||"",this.trData=[],this.opBalance=0,this.showTable=!1}setEnvLanguage(){this.ps.getTranslateLang().subscribe(o=>{this.currentLanguage=o,Object.keys(this.languageLabelData.English).forEach(e=>{this.languageLabelData[this.currentLanguage]&&this.languageLabelData[this.currentLanguage][e]&&this.languageLabelData[this.currentLanguage][e]!==""?this.languageLabels[e]=this.languageLabelData[this.currentLanguage][e]:this.languageLabels[e]=this.languageLabelData.English[e]})})}createSavingsForm(){this.shareForm=this._fb.group({acc_id:new C(null,x.required),start_date:new C(null,x.required),end_date:new C(null,x.required)})}changeDate(o){this.shareForm.get("start_date")?.valid&&o=="start_date"&&(this.endDateMinDate=this.shareForm.get("start_date")?.value),this.shareForm.get("start_date")?.valid&&this.shareForm.get("end_date")?.valid&&this.shareForm.get("end_date")?.value<this.shareForm.get("start_date")?.value&&this.shareForm.get("end_date")?.setValue(this.maxDate)}onSubmit(o){let e={acc_id:this.urlAccId,business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"Ledger",product:this.urlProduct,start_date:P(o.value.start_date,"YYYY-MM-DD"),end_date:P(o.value.end_date,"YYYY-MM-DD")};this.api.post(T.TRANSCATION,e).subscribe(t=>{let l=t?.payload?.data;if(this.trData=l?.data||[],this.opBalance=l?.opening||0,this.showTable=!0,this.trData&&this.trData.length>0){let s=this.opBalance;for(let _=this.trData.length-1;_>=0;_--){let y=this.trData[_];y.balance_amount=s+(y.cr_amount-y.dr_amount),s+=y.cr_amount-y.dr_amount}}})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||d)(v(z),v(O),v(Y),v(re),v(K),v(k),v(oe))};static \u0275cmp=M({type:d,selectors:[["app-share-transaction"]],decls:37,vars:26,consts:[["start_date",""],["end_date",""],["dt1",""],[1,"text-center","pt-2"],[1,"px-3",3,"keydown.enter","submit","formGroup"],[1,"mb-4"],[1,"grid"],[1,"col-6","sm:col-4","md:col-3"],[1,"field","grid"],[1,"col-12","md:col-12"],["appendTo","body","id","start_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","start_date",3,"onSelect","onInput","maxDate","showIcon","showClear","required"],["appendTo","body","id","end_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","end_date",3,"onSelect","onInput","minDate","maxDate","showIcon","showClear","required"],[1,"col-10"],[1,"col-12"],["id","acc_id","styleClass","w-full","appendTo","body","name","acc_id","optionValue","id","optionLabel","label","formControlName","acc_id","placeholder","Select",3,"onChange","options"],[1,"col-2"],["appStopPropagation","",1,"form-save-btn"],["type","submit","pButton","","icon","pi pi-search",1,"p-button-sm",2,"height","2rem",3,"disabled"],[1,"col-3"],[1,"col-4","font-bold","pl-0"],[1,"col-3","font-bold","pl-0"],["class","trans-card",4,"ngIf"],[1,"trans-card"],["styleClass","p-datatable-gridlines p-datatable-striped","scrollHeight","calc(100vh - var(--pro-header-height) - var(--pro-footer-height) - 340px)",3,"value","scrollDirection","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"hidden","sm:flex"],["width","20%"],["width","20%",1,"text-right"],[1,"flex","sm:hidden"],["width","50%",2,"border-right","none"],["width","50%",2,"border-left","none"],[1,"text-right"],[2,"color","green"],[2,"color","red"],["style","color: green","class","text-right",4,"ngIf"],["style","color: red","class","text-right",4,"ngIf"],[1,"text-xs","text-right"],[1,"text-right",2,"color","green"],[1,"text-right",2,"color","red"]],template:function(e,t){if(e&1){let l=F();i(0,"div",3)(1,"h1"),r(2),n()(),i(3,"form",4),S("keydown.enter",function(_){return g(l),b(_.preventDefault())})("submit",function(){return g(l),b(t.onSubmit(t.shareForm))}),i(4,"div",5)(5,"p-card")(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"p-datepicker",10,0),S("onSelect",function(){return g(l),b(t.changeDate("start_date"))})("onInput",function(){return g(l),b(t.changeDate("start_date"))}),n()()()(),i(12,"div",7)(13,"div",8)(14,"div",9)(15,"p-datepicker",11,1),S("onSelect",function(){return g(l),b(t.changeDate("end_date"))})("onInput",function(){return g(l),b(t.changeDate("end_date"))}),n()()()(),i(17,"div",12)(18,"div",8)(19,"div",13)(20,"p-dropdown",14),S("onChange",function(_){return g(l),b(t.onAccountChange(_.value))}),n()()()(),i(21,"div",15)(22,"div",16),A(23,"button",17),n()(),i(24,"div",13)(25,"div",6)(26,"div",18),r(27),n(),i(28,"div",19),r(29),p(30,"dynamicDecimal"),n(),i(31,"div",15),r(32),n(),i(33,"div",20),r(34),p(35,"dynamicDecimal"),n()()()()()(),D(36,ue,5,3,"p-card",21),n()}e&2&&(a(2),c(t.languageLabels.Share),a(),m("formGroup",t.shareForm),a(7),m("maxDate",t.maxDate)("showIcon",!0)("showClear",!0)("required",!0),a(5),m("minDate",t.endDateMinDate)("maxDate",t.maxDate)("showIcon",!0)("showClear",!0)("required",!0),a(5),m("options",t.accountList),a(3),m("disabled",t.shareForm.invalid),a(4),u("",t.languageLabels.Balance,":"),a(2),u(" ",h(30,18,t.selectedAccount.account_balance_derived?t.selectedAccount.account_balance_derived:0,t.decimalPoints,t.comaSaprator)," "),a(3),u("",t.languageLabels.Hold,":"),a(2),u(" ",h(35,22,t.selectedAccount.total_amount_on_hold?t.selectedAccount.total_amount_on_hold:0,t.decimalPoints,t.comaSaprator)," "),a(2),m("ngIf",t.showTable))},dependencies:[ne,N,R,j,Z,ee,ae,H,q,G,W,$,U,te,X,J,Q,V,ie],styles:["[_nghost-%COMP%]     .p-card .p-card-content{padding:0}[_nghost-%COMP%]     .trans-card .p-card .p-card-body{padding:0}[_nghost-%COMP%]     .p-tabview .p-tabview-nav{display:flex;justify-content:space-between}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li{flex:1;text-align:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{justify-content:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li:last-child{border-right:none;border-top-right-radius:4px}[_nghost-%COMP%]     .p-tabview .p-tabview-panels{padding:0}[_nghost-%COMP%]     .p-disabled, .p-component[_ngcontent-%COMP%]:disabled{opacity:1}[_nghost-%COMP%]     .p-tabview .p-datatable .p-datatable-thead>tr>th{background:#f8f8ff}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{color:#000}[_nghost-%COMP%]     .list-card .p-datatable .p-datatable-tbody>tr>td{border:1px solid black;border-width:0 0 1px 0}"]})};export{de as ShareTransactionComponent};
