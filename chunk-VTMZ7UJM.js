import{a as P,b as pe}from"./chunk-GL5CNTKD.js";import{a as E,b as ce,c as se}from"./chunk-V7EBA6X5.js";import{$ as ae,A as G,B as H,D as w,E as $,G as U,H as W,I as z,K as J,O as K,P as Q,V as X,X as Z,Y as ee,Z as te,a as Y,aa as ie,ba as ne,ca as le,da as re,fa as oe,ga as de,i as R,q as j,s as q,z as L}from"./chunk-4HOK7LM6.js";import{$c as N,Cb as s,Lb as i,Mb as n,Nb as f,Rb as B,Tb as S,Ub as x,Xc as k,a as A,ad as V,b as F,bb as a,cb as h,dc as l,ec as d,fc as u,gc as C,gd as O,h as T,nb as M,oa as g,pa as b,ub as D,vc as m,xc as I,yc as _}from"./chunk-HV3O5WE3.js";function ue(o,r){if(o&1&&(i(0,"tr",44)(1,"th",45),l(2),n(),i(3,"th",45),l(4),n(),i(5,"th",46),l(6),n(),i(7,"th",46),l(8),n(),i(9,"th",46),l(10),n()(),i(11,"tr",47)(12,"th",48)(13,"div"),l(14),n(),i(15,"div"),l(16),n()(),i(17,"th",49)(18,"div",50)(19,"span",51),l(20),n(),l(21,"/"),i(22,"span",52),l(23),n()(),i(24,"div",50),l(25),n()()()),o&2){let e=x(2);a(2),d(e.languageLabels.Date),a(2),d(e.languageLabels.Remarks),a(2),u(" ",e.languageLabels.Credit," "),a(2),u(" ",e.languageLabels.Debit," "),a(2),u(" ",e.languageLabels.Balance," "),a(4),d(e.languageLabels.Date),a(2),d(e.languageLabels.Remarks),a(4),d(e.languageLabels.Credit),a(3),d(e.languageLabels.Debit),a(2),d(e.languageLabels.Balance)}}function _e(o,r){if(o&1&&(i(0,"div",56),l(1),m(2,"dynamicDecimal"),n()),o&2){let e=x().$implicit,t=x(2);a(),u(" ",_(2,1,e.principal_cr,t.decimalPoints,t.comaSaprator)," ")}}function ve(o,r){if(o&1&&(i(0,"div",57),l(1),m(2,"dynamicDecimal"),n()),o&2){let e=x().$implicit,t=x(2);a(),u(" ",_(2,1,e.principal_dr,t.decimalPoints,t.comaSaprator)," ")}}function ge(o,r){if(o&1&&(i(0,"tr",44)(1,"td",45),l(2),m(3,"date"),n(),i(4,"td",45),l(5),n(),i(6,"td",46),l(7),m(8,"dynamicDecimal"),n(),i(9,"td",46),l(10),m(11,"dynamicDecimal"),n(),i(12,"td",46),l(13),m(14,"dynamicDecimal"),n()(),i(15,"tr",47)(16,"td",48)(17,"div"),l(18),m(19,"date"),n(),i(20,"div"),l(21),n()(),i(22,"td",49),D(23,_e,3,5,"div",53)(24,ve,3,5,"div",54),i(25,"div",55),l(26),m(27,"dynamicDecimal"),n()()()),o&2){let e=r.$implicit,t=x(2);a(2),d(I(3,12,e.date1,"dd-MM-yyyy")),a(3),d(e.remarks),a(2),u(" ",e.principal_cr>0?_(8,15,e.principal_cr,t.decimalPoints,t.comaSaprator):""," "),a(3),u(" ",e.principal_dr>0?_(11,19,e.principal_dr,t.decimalPoints,t.comaSaprator):""," "),a(3),C(" ",_(14,23,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),t.decimalPoints,t.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," "),a(5),d(I(19,27,e.date1,"dd-MM-yyyy")),a(3),d(e.remarks),a(2),s("ngIf",e.principal_cr!=0),a(),s("ngIf",e.principal_dr!=0),a(2),C(" ",_(27,30,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),t.decimalPoints,t.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," ")}}function be(o,r){if(o&1&&(i(0,"div",58),l(1),n()),o&2){let e=r.$implicit,t=r.index;a(),C(" ",t+1+". "," ",e.display_name," ")}}function he(o,r){if(o&1&&(i(0,"p-card",22)(1,"p-tabView")(2,"p-tabPanel",23)(3,"p-table",24,2),D(5,ue,26,10,"ng-template",25)(6,ge,28,34,"ng-template",26),n()(),i(7,"p-tabPanel",23)(8,"div",27)(9,"div",28)(10,"div",8)(11,"label",29),l(12),n(),i(13,"div",30),f(14,"input",31),n()()(),i(15,"div",13)(16,"div",8)(17,"label",32),l(18),n(),i(19,"div",30),f(20,"input",33),m(21,"date"),n()()(),i(22,"div",13)(23,"div",8)(24,"label",34),l(25),n(),i(26,"div",30),f(27,"input",35),n()()(),i(28,"div",13)(29,"div",8)(30,"label",36),l(31),n(),i(32,"div",30),f(33,"input",37),n()()(),i(34,"div",13)(35,"div",8)(36,"label",38),l(37),n(),i(38,"div",30),f(39,"input",39),n()()(),i(40,"div",13)(41,"div",8)(42,"label",40),l(43),n(),i(44,"div",30),f(45,"input",41),m(46,"date"),n()()(),i(47,"div",13)(48,"div",8)(49,"label",42),l(50),n(),i(51,"div",30),D(52,be,2,2,"div",43),n()()()()()()()),o&2){let e=x();a(2),s("header",e.languageLabels.Transaction),a(),s("value",e.trData)("scrollDirection","vertical")("scrollable",!0),a(4),s("header",e.languageLabels.Details),a(5),d(e.languageLabels.principal_amount),a(2),s("value",e.selectedAccount.principal_amount?e.selectedAccount.principal_amount:null),a(4),d(e.languageLabels.loan_disburse_date),a(2),s("value",e.selectedAccount.loan_disburse_date?I(21,19,e.selectedAccount.loan_disburse_date,"dd-MM-yyyy"):null),a(5),d(e.languageLabels.Interest),a(2),s("value",e.selectedAccount.interest_rate?e.selectedAccount.interest_rate:null),a(4),d(e.languageLabels.total_installment),a(2),s("value",e.selectedAccount.total_installment?e.selectedAccount.total_installment:null),a(4),d(e.languageLabels.installment_amount),a(2),s("value",e.selectedAccount.installment_amount?e.selectedAccount.installment_amount:null),a(4),d(e.languageLabels.due_date),a(2),s("value",e.selectedAccount.due_date?I(46,22,e.selectedAccount.due_date,"dd-MM-yyyy"):null),a(5),d(e.languageLabels.guarantor),a(2),s("ngForOf",e.selectedAccount.guarantor_data)}}var me=class o{constructor(r,e,t,c,p,v,y){this._fb=r;this.api=e;this.http=t;this.cryptoUrl=c;this.ps=p;this.route=v;this.location=y;this.languageLabelData=pe}loanForm;comaSaprator;decimalPoints;maxDate;minDate;endDateMinDate;urlProduct;urlAccId;urlBusinessNumber;urlBusinessCode;cifId;cifMobile;productMap={1002:"Share",1003:"Savings",1005:"FD",1006:"RD",1007:"Loan"};accountList=[];accountDisplayLabel="";selectedAccount=[];trData=[];opBalance=0;showTable=!1;currentLanguage;languageLabelData;languageLabels={};ngOnInit(){return T(this,null,function*(){this.createSavingsForm(),this.setEnvLanguage();let r=localStorage.getItem("ledger_client_id");r||(r=crypto.randomUUID(),localStorage.setItem("ledger_client_id",r)),this.route.queryParams.subscribe(e=>T(this,null,function*(){let t=e.t;if(!t){alert("Invalid or missing link");return}let p=yield this.cryptoUrl.decryptToken(t,"69f10c10568abe88bf8374203375a4b6");if(this.cifId=p.cif_id,this.cifMobile=p.cif_mobile,this.urlProduct=Number(p.product),this.urlBusinessNumber=p.businessNumber,this.urlBusinessCode=p.business_code,!this.cifId||!this.urlProduct||!this.urlBusinessNumber||!this.urlBusinessCode){alert("Invalid decrypted data");return}this.validateLedgerAccess(p.token)}))})}validateLedgerAccess(r){let e=localStorage.getItem("ledger_client_id");if(!e){alert("Invalid session");return}this.http.get("http://localhost:8800/whatsAppDemo/api/ledger/validate",{params:{token:r,client_id:e}}).subscribe({next:()=>{this.fetchProductAccounts()},error:t=>{let c=t.error?.reason;alert(c==="expired"?"\u23F1 Link expired. Please open again from WhatsApp.":c==="link_already_used"?"\u274C This link was already used.":"\u274C Invalid link")}})}fetchProductAccounts(){let r={business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"productBalance",cif_mobile:this.cifMobile,cif_id:this.cifId,product:this.urlProduct};this.api.post(E.TRANSCATION,r).subscribe(e=>{let t=e?.payload?.data?.balanceData?.data||e?.data?.balanceData?.data||[];this.accountList=t.map(c=>F(A({},c),{label:`${c.account_no} - ${c.product_name}`}))})}onAccountChange(r){this.urlAccId=r,this.selectedAccount=this.accountList.find(e=>e.id===r)||{},this.accountDisplayLabel=this.selectedAccount.label||"",this.trData=[],this.opBalance=0,this.showTable=!1}setEnvLanguage(){this.ps.getTranslateLang().subscribe(r=>{this.currentLanguage=r,Object.keys(this.languageLabelData.English).forEach(e=>{this.languageLabelData[this.currentLanguage]&&this.languageLabelData[this.currentLanguage][e]&&this.languageLabelData[this.currentLanguage][e]!==""?this.languageLabels[e]=this.languageLabelData[this.currentLanguage][e]:this.languageLabels[e]=this.languageLabelData.English[e]})})}createSavingsForm(){this.loanForm=this._fb.group({acc_id:new w(null,L.required),start_date:new w(null,L.required),end_date:new w(null,L.required)})}changeDate(r){this.loanForm.get("start_date")?.valid&&r=="start_date"&&(this.endDateMinDate=this.loanForm.get("start_date")?.value),this.loanForm.get("start_date")?.valid&&this.loanForm.get("end_date")?.valid&&this.loanForm.get("end_date")?.value<this.loanForm.get("start_date")?.value&&this.loanForm.get("end_date")?.setValue(this.maxDate)}onSubmit(r){let e={acc_id:this.urlAccId,business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"Ledger",product:this.urlProduct,start_date:P(r.value.start_date,"YYYY-MM-DD"),end_date:P(r.value.end_date,"YYYY-MM-DD")};this.api.post(E.TRANSCATION,e).subscribe(t=>{let c=t?.payload?.data;if(this.trData=c?.data||[],this.opBalance=c?.opening||0,this.showTable=!0,this.trData&&this.trData.length>0){let p=this.opBalance;for(let v=this.trData.length-1;v>=0;v--){let y=this.trData[v];y.balance_amount=p+(y.principal_dr-y.principal_cr),p+=y.principal_dr-y.principal_cr}}})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||o)(h(J),h(ce),h(Y),h(se),h(X),h(R),h(k))};static \u0275cmp=M({type:o,selectors:[["app-loan-transaction"]],decls:37,vars:27,consts:[["start_date",""],["end_date",""],["dt1",""],[1,"text-center","pt-2"],[1,"px-3",3,"keydown.enter","submit","formGroup"],[1,"mb-4"],[1,"grid"],[1,"col-6","sm:col-4","md:col-3"],[1,"field","grid"],[1,"col-12","md:col-12"],["appendTo","body","id","start_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","start_date",3,"onSelect","onInput","minDate","maxDate","showIcon","showClear","required"],["appendTo","body","id","end_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","end_date",3,"onSelect","onInput","minDate","maxDate","showIcon","showClear","required"],[1,"col-10"],[1,"col-12"],["id","acc_id","styleClass","w-full","appendTo","body","name","acc_id","optionValue","id","optionLabel","label","formControlName","acc_id","placeholder","Select",3,"onChange","options"],[1,"col-2"],["appStopPropagation","",1,"form-save-btn"],["type","submit","pButton","","icon","pi pi-search",1,"p-button-sm",2,"height","2rem",3,"disabled"],[1,"col-3"],[1,"col-4","font-bold","pl-0"],[1,"col-3","font-bold","pl-0"],["class","trans-card",4,"ngIf"],[1,"trans-card"],[3,"header"],["styleClass","p-datatable-gridlines p-datatable-striped","scrollHeight","calc(100vh - var(--pro-header-height) - var(--pro-footer-height) - 340px)",3,"value","scrollDirection","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"grid","px-3"],[1,"col-12","mt-3"],["htmlFor","principal_amount",1,"col-4","mb-2","md:col-3","md:mb-0"],[1,"col-8","md:col-9"],["pInputText","","id","principal_amount","disabled","","type","text",3,"value"],["htmlFor","loan_disburse_date",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","loan_disburse_date","disabled","","type","text",3,"value"],["htmlFor","interest_rate",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","interest_rate","disabled","","type","text",3,"value"],["htmlFor","total_installment",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","total_installment","disabled","","type","text",3,"value"],["htmlFor","installment_amount",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","installment_amount","disabled","","type","text",3,"value"],["htmlFor","due_date",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","due_date","disabled","","type","text",3,"value"],["htmlFor","guarantor",1,"col-4","mb-2","md:col-3","md:mb-0"],["class","text-xs sm:text-sm",4,"ngFor","ngForOf"],[1,"hidden","sm:flex"],["width","20%"],["width","20%",1,"text-right"],[1,"flex","sm:hidden"],["width","50%",2,"border-right","none"],["width","50%",2,"border-left","none"],[1,"text-right"],[2,"color","green"],[2,"color","red"],["style","color: green","class","text-right",4,"ngIf"],["style","color: red","class","text-right",4,"ngIf"],[1,"text-xs","text-right"],[1,"text-right",2,"color","green"],[1,"text-right",2,"color","red"],[1,"text-xs","sm:text-sm"]],template:function(e,t){if(e&1){let c=B();i(0,"div",3)(1,"h1"),l(2),n()(),i(3,"form",4),S("keydown.enter",function(v){return g(c),b(v.preventDefault())})("submit",function(){return g(c),b(t.onSubmit(t.loanForm))}),i(4,"div",5)(5,"p-card")(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"p-datepicker",10,0),S("onSelect",function(){return g(c),b(t.changeDate("start_date"))})("onInput",function(){return g(c),b(t.changeDate("start_date"))}),n()()()(),i(12,"div",7)(13,"div",8)(14,"div",9)(15,"p-datepicker",11,1),S("onSelect",function(){return g(c),b(t.changeDate("end_date"))})("onInput",function(){return g(c),b(t.changeDate("end_date"))}),n()()()(),i(17,"div",12)(18,"div",8)(19,"div",13)(20,"p-dropdown",14),S("onChange",function(v){return g(c),b(t.onAccountChange(v.value))}),n()()()(),i(21,"div",15)(22,"div",16),f(23,"button",17),n()(),i(24,"div",13)(25,"div",6)(26,"div",18),l(27),n(),i(28,"div",19),l(29),m(30,"dynamicDecimal"),n(),i(31,"div",15),l(32),n(),i(33,"div",20),l(34),m(35,"dynamicDecimal"),n()()()()()(),D(36,he,53,25,"p-card",21),n()}e&2&&(a(2),d(t.languageLabels.Loan),a(),s("formGroup",t.loanForm),a(7),s("minDate",t.minDate)("maxDate",t.maxDate)("showIcon",!0)("showClear",!0)("required",!0),a(5),s("minDate",t.endDateMinDate)("maxDate",t.maxDate)("showIcon",!0)("showClear",!0)("required",!0),a(5),s("options",t.accountList),a(3),s("disabled",t.loanForm.invalid),a(4),u("",t.languageLabels.Balance,":"),a(2),u(" ",_(30,19,t.selectedAccount.principal_outstanding_derived?t.selectedAccount.principal_outstanding_derived:0,t.decimalPoints,t.comaSaprator)," "),a(3),u("",t.languageLabels.Due,":"),a(2),u(" ",_(35,23,t.selectedAccount.total_amount_on_hold?t.selectedAccount.total_amount_on_hold:0,t.decimalPoints,t.comaSaprator)," "),a(2),s("ngIf",t.showTable))},dependencies:[de,N,V,j,q,te,ae,Q,ne,re,le,$,G,H,z,U,W,ie,ee,K,Z,O,oe],styles:["[_nghost-%COMP%]     .p-card .p-card-content{padding:0}[_nghost-%COMP%]     .trans-card .p-card .p-card-body{padding:0}[_nghost-%COMP%]     .p-tabview .p-tabview-nav{display:flex;justify-content:space-between}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li{flex:1;text-align:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{justify-content:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li:last-child{border-right:none;border-top-right-radius:4px}[_nghost-%COMP%]     .p-tabview .p-tabview-panels{padding:0}[_nghost-%COMP%]     .p-disabled, .p-component[_ngcontent-%COMP%]:disabled{opacity:1}[_nghost-%COMP%]     .p-tabview .p-datatable .p-datatable-thead>tr>th{background:#f8f8ff}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{color:#000}[_nghost-%COMP%]     .list-card .p-datatable .p-datatable-tbody>tr>td{border:1px solid black;border-width:0 0 1px 0}"]})};export{me as LoanTransactionComponent};
