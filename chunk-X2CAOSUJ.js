import{a as A,b as ce}from"./chunk-GL5CNTKD.js";import{a as E,b as de,c as se}from"./chunk-V7EBA6X5.js";import{$ as te,A as q,B as H,D as T,E as G,G as $,H as U,I as W,K as z,O as J,P as K,V as Q,X,Y as Z,Z as ee,a as O,aa as ae,ba as ie,ca as ne,da as re,fa as le,ga as oe,i as Y,q as R,s as j,z as w}from"./chunk-4HOK7LM6.js";import{$c as N,Cb as c,Lb as i,Mb as n,Nb as y,Rb as B,Tb as D,Ub as h,a as P,ad as k,b as F,bb as a,cb as f,dc as r,ec as s,fc as m,gc as I,gd as V,h as L,nb as M,oa as g,pa as b,ub as S,vc as u,xc as C,yc as v}from"./chunk-HV3O5WE3.js";function me(o,l){if(o&1&&(i(0,"tr",42)(1,"th",43),r(2),n(),i(3,"th",43),r(4),n(),i(5,"th",44),r(6),n(),i(7,"th",44),r(8),n(),i(9,"th",44),r(10),n()(),i(11,"tr",45)(12,"th",46)(13,"div"),r(14),n(),i(15,"div"),r(16),n()(),i(17,"th",47)(18,"div",48)(19,"span",49),r(20),n(),r(21,"/"),i(22,"span",50),r(23),n()(),i(24,"div",48),r(25),n()()()),o&2){let e=h(2);a(2),s(e.languageLabels.Date),a(2),s(e.languageLabels.Remarks),a(2),m(" ",e.languageLabels.Credit," "),a(2),m(" ",e.languageLabels.Debit," "),a(2),m(" ",e.languageLabels.Balance," "),a(4),s(e.languageLabels.Date),a(2),s(e.languageLabels.Remarks),a(4),s(e.languageLabels.Credit),a(3),s(e.languageLabels.Debit),a(2),s(e.languageLabels.Balance)}}function ue(o,l){if(o&1&&(i(0,"div",54),r(1),u(2,"dynamicDecimal"),n()),o&2){let e=h().$implicit,t=h(2);a(),m(" ",v(2,1,e.cr_amount,t.decimalPoints,t.comaSaprator)," ")}}function ve(o,l){if(o&1&&(i(0,"div",55),r(1),u(2,"dynamicDecimal"),n()),o&2){let e=h().$implicit,t=h(2);a(),m(" ",v(2,1,e.dr_amount,t.decimalPoints,t.comaSaprator)," ")}}function _e(o,l){if(o&1&&(i(0,"tr",42)(1,"td",43),r(2),u(3,"date"),n(),i(4,"td",43),r(5),n(),i(6,"td",44),r(7),u(8,"dynamicDecimal"),n(),i(9,"td",44),r(10),u(11,"dynamicDecimal"),n(),i(12,"td",44),r(13),u(14,"dynamicDecimal"),n()(),i(15,"tr",45)(16,"td",46)(17,"div"),r(18),u(19,"date"),n(),i(20,"div"),r(21),n()(),i(22,"td",47),S(23,ue,3,5,"div",51)(24,ve,3,5,"div",52),i(25,"div",53),r(26),u(27,"dynamicDecimal"),n()()()),o&2){let e=l.$implicit,t=h(2);a(2),s(C(3,12,e.date1,"dd-MM-yyyy")),a(3),s(e.remarks),a(2),m(" ",e.cr_amount>0?v(8,15,e.cr_amount,t.decimalPoints,t.comaSaprator):""," "),a(3),m(" ",e.dr_amount>0?v(11,19,e.dr_amount,t.decimalPoints,t.comaSaprator):""," "),a(3),I(" ",v(14,23,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),t.decimalPoints,t.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," "),a(5),s(C(19,27,e.date1,"dd-MM-yyyy")),a(3),s(e.remarks),a(2),c("ngIf",e.cr_amount!=0),a(),c("ngIf",e.dr_amount!=0),a(2),I(" ",v(27,30,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),t.decimalPoints,t.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," ")}}function ge(o,l){if(o&1&&(i(0,"div",56),r(1),n()),o&2){let e=l.$implicit,t=l.index;a(),I(" ",t+1+". "," ",e.display_name," ")}}function be(o,l){if(o&1&&(i(0,"p-card",22)(1,"p-tabView")(2,"p-tabPanel",23)(3,"p-table",24,2),S(5,me,26,10,"ng-template",25)(6,_e,28,34,"ng-template",26),n()(),i(7,"p-tabPanel",23)(8,"div",27)(9,"div",28)(10,"div",8)(11,"label",29),r(12),n(),i(13,"div",30),y(14,"input",31),u(15,"date"),n()()(),i(16,"div",13)(17,"div",8)(18,"label",32),r(19),n(),i(20,"div",30),y(21,"input",33),n()()(),i(22,"div",13)(23,"div",8)(24,"label",34),r(25),n(),i(26,"div",30),y(27,"input",35),n()()(),i(28,"div",13)(29,"div",8)(30,"label",36),r(31),n(),i(32,"div",30),y(33,"input",37),n()()(),i(34,"div",13)(35,"div",8)(36,"label",38),r(37),n(),i(38,"div",30),y(39,"input",39),n()()(),i(40,"div",13)(41,"div",8)(42,"label",40),r(43),n(),i(44,"div",30),S(45,ge,2,2,"div",41),n()()()()()()()),o&2){let e=h();a(2),c("header",e.languageLabels.Transaction),a(),c("value",e.trData)("scrollDirection","vertical")("scrollable",!0),a(4),c("header",e.languageLabels.Details),a(5),s(e.languageLabels.open_date),a(2),c("value",e.selectedAccount.approvedon_date?C(15,17,e.selectedAccount.approvedon_date,"dd-MM-yyyy"):null),a(5),s(e.languageLabels.Interest),a(2),c("value",e.selectedAccount.annual_interest_rate||e.selectedAccount.annual_interest_rate==0?e.selectedAccount.annual_interest_rate:null),a(4),s(e.languageLabels.nominee_name),a(2),c("value",e.selectedAccount.nominee_data!=null&&e.selectedAccount.nominee_data[0]?e.selectedAccount.nominee_data[0].nominee_name:null),a(4),s(e.languageLabels["Owner Type"]),a(2),c("value",e.selectedAccount.owner_type?e.selectedAccount.owner_type:null),a(4),s(e.languageLabels["Access By"]),a(2),c("value",e.selectedAccount.access_by?e.selectedAccount.access_by:null),a(4),s(e.languageLabels.account_holders),a(2),c("ngForOf",e.selectedAccount.acc_holder_data)}}var pe=class o{constructor(l,e,t,d,p,_){this._fb=l;this.route=e;this.http=t;this.api=d;this.ps=p;this.cryptoUrl=_;this.languageLabelData=ce}savingsForm;comaSaprator;decimalPoints;maxDate;minDate;endDateMinDate;urlProduct;urlAccId;urlBusinessNumber;urlBusinessCode;cifId;cifMobile;productMap={1002:"Share",1003:"Savings",1005:"FD",1006:"RD",1007:"Loan"};accountList=[];accountDisplayLabel="";selectedAccount=[];trData=[];opBalance=0;showTable=!1;currentLanguage;languageLabelData;languageLabels={};ngOnInit(){return L(this,null,function*(){this.createSavingsForm(),this.setEnvLanguage();let l=localStorage.getItem("ledger_client_id");l||(l=crypto.randomUUID(),localStorage.setItem("ledger_client_id",l)),this.route.queryParams.subscribe(e=>L(this,null,function*(){let t=e.t;if(!t){alert("Invalid or missing link");return}let p=yield this.cryptoUrl.decryptToken(t,"69f10c10568abe88bf8374203375a4b6");if(this.cifId=p.cif_id,this.cifMobile=p.cif_mobile,this.urlProduct=Number(p.product),this.urlBusinessNumber=p.businessNumber,this.urlBusinessCode=p.business_code,!this.cifId||!this.urlProduct||!this.urlBusinessNumber||!this.urlBusinessCode){alert("Invalid decrypted data");return}this.validateLedgerAccess(p.token)}))})}validateLedgerAccess(l){let e=localStorage.getItem("ledger_client_id");if(!e){alert("Invalid session");return}this.http.get("http://localhost:8800/whatsAppDemo/api/ledger/validate",{params:{token:l,client_id:e}}).subscribe({next:()=>{this.fetchProductAccounts()},error:t=>{let d=t.error?.reason;alert(d==="expired"?"\u23F1 Link expired. Please open again from WhatsApp.":d==="link_already_used"?"\u274C This link was already used.":"\u274C Invalid link")}})}fetchProductAccounts(){let l={business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"productBalance",cif_mobile:this.cifMobile,cif_id:this.cifId,product:this.urlProduct};this.api.post(E.TRANSCATION,l).subscribe(e=>{let t=e?.payload?.data?.balanceData?.data||e?.data?.balanceData?.data||[];this.accountList=t.map(d=>F(P({},d),{label:`${d.account_no} - ${d.product_name}`}))})}onAccountChange(l){this.urlAccId=l,this.selectedAccount=this.accountList.find(e=>e.id===l)||{},this.accountDisplayLabel=this.selectedAccount.label||"",this.trData=[],this.opBalance=0,this.showTable=!1}setEnvLanguage(){this.ps.getTranslateLang().subscribe(l=>{this.currentLanguage=l,Object.keys(this.languageLabelData.English).forEach(e=>{this.languageLabelData[this.currentLanguage]&&this.languageLabelData[this.currentLanguage][e]&&this.languageLabelData[this.currentLanguage][e]!==""?this.languageLabels[e]=this.languageLabelData[this.currentLanguage][e]:this.languageLabels[e]=this.languageLabelData.English[e]})})}createSavingsForm(){this.savingsForm=this._fb.group({acc_id:new T(null,w.required),start_date:new T(null,w.required),end_date:new T(null,w.required)})}changeDate(l){this.savingsForm.get("start_date")?.valid&&l=="start_date"&&(this.endDateMinDate=this.savingsForm.get("start_date")?.value),this.savingsForm.get("start_date")?.valid&&this.savingsForm.get("end_date")?.valid&&this.savingsForm.get("end_date")?.value<this.savingsForm.get("start_date")?.value&&this.savingsForm.get("end_date")?.setValue(this.maxDate)}onSubmit(l){let e={acc_id:this.urlAccId,business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"Ledger",product:this.urlProduct,start_date:A(l.value.start_date,"YYYY-MM-DD"),end_date:A(l.value.end_date,"YYYY-MM-DD")};this.api.post(E.TRANSCATION,e).subscribe(t=>{let d=t?.payload?.data;if(this.trData=d?.data||[],this.opBalance=d?.opening||0,this.showTable=!0,this.trData&&this.trData.length>0){let p=this.opBalance;for(let _=this.trData.length-1;_>=0;_--){let x=this.trData[_];x.balance_amount=p+(x.cr_amount-x.dr_amount),p+=x.cr_amount-x.dr_amount}}})}static \u0275fac=function(e){return new(e||o)(f(z),f(Y),f(O),f(de),f(Q),f(se))};static \u0275cmp=M({type:o,selectors:[["app-savings-transaction"]],decls:37,vars:26,consts:[["start_date",""],["end_date",""],["dt1",""],[1,"text-center","pt-2"],[1,"px-3",3,"keydown.enter","submit","formGroup"],[1,"mb-4"],[1,"grid"],[1,"col-6","sm:col-4","md:col-3"],[1,"field","grid"],[1,"col-12","md:col-12"],["appendTo","body","id","start_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","start_date",3,"onSelect","onInput","maxDate","showIcon","showClear","required"],["appendTo","body","id","end_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","end_date",3,"onSelect","onInput","minDate","maxDate","showIcon","showClear","required"],[1,"col-10"],[1,"col-12"],["id","acc_id","styleClass","w-full","appendTo","body","name","acc_id","optionValue","id","optionLabel","label","formControlName","acc_id","placeholder","Select",3,"onChange","options"],[1,"col-2"],["appStopPropagation","",1,"form-save-btn"],["type","submit","pButton","","icon","pi pi-search",1,"p-button-sm",2,"height","2rem",3,"disabled"],[1,"col-3"],[1,"col-4","font-bold","pl-0"],[1,"col-3","font-bold","pl-0"],["class","trans-card",4,"ngIf"],[1,"trans-card"],[3,"header"],["styleClass","p-datatable-gridlines p-datatable-striped","scrollHeight","calc(100vh - var(--pro-header-height) - var(--pro-footer-height) - 340px)",3,"value","scrollDirection","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"grid","px-3"],[1,"col-12","mt-3"],["htmlFor","open_date",1,"col-4","mb-2","md:col-3","md:mb-0"],[1,"col-8","md:col-9"],["pInputText","","id","open_date","disabled","","type","text",3,"value"],["htmlFor","annual_interest_rate",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","annual_interest_rate","disabled","","type","text",3,"value"],["htmlFor","nominee_name",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","nominee_name","disabled","","type","text",3,"value"],["htmlFor","owner_type",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","owner_type","disabled","","type","text",3,"value"],["htmlFor","access_by",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","access_by","disabled","","type","text",3,"value"],["htmlFor","account_holders",1,"col-4","mb-2","md:col-3","md:mb-0"],["class","text-xs sm:text-sm",4,"ngFor","ngForOf"],[1,"hidden","sm:flex"],["width","20%"],["width","20%",1,"text-right"],[1,"flex","sm:hidden"],["width","50%",2,"border-right","none"],["width","50%",2,"border-left","none"],[1,"text-right"],[2,"color","green"],[2,"color","red"],["style","color: green","class","text-right",4,"ngIf"],["style","color: red","class","text-right",4,"ngIf"],[1,"text-xs","text-right"],[1,"text-right",2,"color","green"],[1,"text-right",2,"color","red"],[1,"text-xs","sm:text-sm"]],template:function(e,t){if(e&1){let d=B();i(0,"div",3)(1,"h1"),r(2),n()(),i(3,"form",4),D("keydown.enter",function(_){return g(d),b(_.preventDefault())})("submit",function(){return g(d),b(t.onSubmit(t.savingsForm))}),i(4,"div",5)(5,"p-card")(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"p-datepicker",10,0),D("onSelect",function(){return g(d),b(t.changeDate("start_date"))})("onInput",function(){return g(d),b(t.changeDate("start_date"))}),n()()()(),i(12,"div",7)(13,"div",8)(14,"div",9)(15,"p-datepicker",11,1),D("onSelect",function(){return g(d),b(t.changeDate("end_date"))})("onInput",function(){return g(d),b(t.changeDate("end_date"))}),n()()()(),i(17,"div",12)(18,"div",8)(19,"div",13)(20,"p-dropdown",14),D("onChange",function(_){return g(d),b(t.onAccountChange(_.value))}),n()()()(),i(21,"div",15)(22,"div",16),y(23,"button",17),n()(),i(24,"div",13)(25,"div",6)(26,"div",18),r(27),n(),i(28,"div",19),r(29),u(30,"dynamicDecimal"),n(),i(31,"div",15),r(32),n(),i(33,"div",20),r(34),u(35,"dynamicDecimal"),n()()()()()(),S(36,be,46,20,"p-card",21),n()}e&2&&(a(2),s(t.languageLabels.Savings),a(),c("formGroup",t.savingsForm),a(7),c("maxDate",t.maxDate)("showIcon",!0)("showClear",!0)("required",!0),a(5),c("minDate",t.endDateMinDate)("maxDate",t.maxDate)("showIcon",!0)("showClear",!0)("required",!0),a(5),c("options",t.accountList),a(3),c("disabled",t.savingsForm.invalid),a(4),m("",t.languageLabels.Balance,":"),a(2),m(" ",v(30,18,t.selectedAccount.account_balance_derived?t.selectedAccount.account_balance_derived:0,t.decimalPoints,t.comaSaprator)," "),a(3),m("",t.languageLabels.Hold,":"),a(2),m(" ",v(35,22,t.selectedAccount.total_amount_on_hold?t.selectedAccount.total_amount_on_hold:0,t.decimalPoints,t.comaSaprator)," "),a(2),c("ngIf",t.showTable))},dependencies:[oe,N,k,R,j,ee,te,K,ie,re,ne,G,q,H,W,$,U,ae,Z,J,X,V,le],styles:["[_nghost-%COMP%]     .p-card .p-card-content{padding:0}[_nghost-%COMP%]     .trans-card .p-card .p-card-body{padding:0}[_nghost-%COMP%]     .p-tabview .p-tabview-nav{display:flex;justify-content:space-between}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li{flex:1;text-align:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{justify-content:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li:last-child{border-right:none;border-top-right-radius:4px}[_nghost-%COMP%]     .p-tabview .p-tabview-panels{padding:0}[_nghost-%COMP%]     .p-disabled, .p-component[_ngcontent-%COMP%]:disabled{opacity:1}[_nghost-%COMP%]     .p-tabview .p-datatable .p-datatable-thead>tr>th{background:#f8f8ff}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{color:#000}[_nghost-%COMP%]     .list-card .p-datatable .p-datatable-tbody>tr>td{border:1px solid black;border-width:0 0 1px 0}"]})};export{pe as SavingsTransactionComponent};
