import{a as A,b as me}from"./chunk-GL5CNTKD.js";import{a as E,b as ce,c as se}from"./chunk-V7EBA6X5.js";import{$ as ae,A as H,B as G,D as T,E as $,G as U,H as W,I as z,K as J,O as K,P as Q,V as X,X as Z,Y as ee,Z as te,a as O,aa as ie,ba as ne,ca as re,da as le,fa as oe,ga as de,i as Y,q as j,s as q,z as w}from"./chunk-4HOK7LM6.js";import{$c as k,Cb as d,Lb as i,Mb as n,Nb as _,Rb as B,Tb as S,Ub as f,Xc as R,a as P,ad as N,b as F,bb as t,cb as y,dc as r,ec as o,fc as u,gc as C,gd as V,h as L,nb as M,oa as g,pa as h,ub as D,vc as p,xc as I,yc as v}from"./chunk-HV3O5WE3.js";function ue(c,l){if(c&1&&(i(0,"tr",48)(1,"th",49),r(2),n(),i(3,"th",49),r(4),n(),i(5,"th",50),r(6),n(),i(7,"th",50),r(8),n(),i(9,"th",50),r(10),n()(),i(11,"tr",51)(12,"th",52)(13,"div"),r(14),n(),i(15,"div"),r(16),n()(),i(17,"th",53)(18,"div",54)(19,"span",55),r(20),n(),r(21,"/"),i(22,"span",56),r(23),n()(),i(24,"div",54),r(25),n()()()),c&2){let e=f(2);t(2),o(e.languageLabels.Date),t(2),o(e.languageLabels.Remarks),t(2),u(" ",e.languageLabels.Credit," "),t(2),u(" ",e.languageLabels.Debit," "),t(2),u(" ",e.languageLabels.Balance," "),t(4),o(e.languageLabels.Date),t(2),o(e.languageLabels.Remarks),t(4),o(e.languageLabels.Credit),t(3),o(e.languageLabels.Debit),t(2),o(e.languageLabels.Balance)}}function _e(c,l){if(c&1&&(i(0,"div",60),r(1),p(2,"dynamicDecimal"),n()),c&2){let e=f().$implicit,a=f(2);t(),u(" ",v(2,1,e.cr_amount,a.decimalPoints,a.comaSaprator)," ")}}function ve(c,l){if(c&1&&(i(0,"div",61),r(1),p(2,"dynamicDecimal"),n()),c&2){let e=f().$implicit,a=f(2);t(),u(" ",v(2,1,e.dr_amount,a.decimalPoints,a.comaSaprator)," ")}}function be(c,l){if(c&1&&(i(0,"tr",48)(1,"td",49),r(2),p(3,"date"),n(),i(4,"td",49),r(5),n(),i(6,"td",50),r(7),p(8,"dynamicDecimal"),n(),i(9,"td",50),r(10),p(11,"dynamicDecimal"),n(),i(12,"td",50),r(13),p(14,"dynamicDecimal"),n()(),i(15,"tr",51)(16,"td",52)(17,"div"),r(18),p(19,"date"),n(),i(20,"div"),r(21),n()(),i(22,"td",53),D(23,_e,3,5,"div",57)(24,ve,3,5,"div",58),i(25,"div",59),r(26),p(27,"dynamicDecimal"),n()()()),c&2){let e=l.$implicit,a=f(2);t(2),o(I(3,12,e.date1,"dd-MM-yyyy")),t(3),o(e.remarks),t(2),u(" ",e.cr_amount>0?v(8,15,e.cr_amount,a.decimalPoints,a.comaSaprator):""," "),t(3),u(" ",e.dr_amount>0?v(11,19,e.dr_amount,a.decimalPoints,a.comaSaprator):""," "),t(3),C(" ",v(14,23,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),a.decimalPoints,a.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," "),t(5),o(I(19,27,e.date1,"dd-MM-yyyy")),t(3),o(e.remarks),t(2),d("ngIf",e.cr_amount!=0),t(),d("ngIf",e.dr_amount!=0),t(2),C(" ",v(27,30,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),a.decimalPoints,a.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," ")}}function ge(c,l){if(c&1&&(i(0,"div",62),r(1),n()),c&2){let e=l.$implicit,a=l.index;t(),C(" ",a+1+". "," ",e.display_name," ")}}function he(c,l){if(c&1&&(i(0,"p-card",22)(1,"p-tabView")(2,"p-tabPanel",23)(3,"p-table",24,2),D(5,ue,26,10,"ng-template",25)(6,be,28,34,"ng-template",26),n()(),i(7,"p-tabPanel",23)(8,"div",27)(9,"div",28)(10,"div",8)(11,"label",29),r(12),n(),i(13,"div",30),_(14,"input",31),p(15,"date"),n()()(),i(16,"div",13)(17,"div",8)(18,"label",32),r(19),n(),i(20,"div",30),_(21,"input",33),p(22,"date"),n()()(),i(23,"div",13)(24,"div",8)(25,"label",34),r(26),n(),i(27,"div",30),_(28,"input",35),n()()(),i(29,"div",13)(30,"div",8)(31,"label",36),r(32),n(),i(33,"div",30),_(34,"input",37),n()()(),i(35,"div",13)(36,"div",8)(37,"label",38),r(38),n(),i(39,"div",30),_(40,"input",39),n()()(),i(41,"div",13)(42,"div",8)(43,"label",40),r(44),n(),i(45,"div",30),_(46,"input",41),n()()(),i(47,"div",13)(48,"div",8)(49,"label",42),r(50),n(),i(51,"div",30),_(52,"input",43),n()()(),i(53,"div",13)(54,"div",8)(55,"label",44),r(56),n(),i(57,"div",30),_(58,"input",45),n()()(),i(59,"div",13)(60,"div",8)(61,"label",46),r(62),n(),i(63,"div",30),D(64,ge,2,2,"div",47),n()()()()()()()),c&2){let e=f();t(2),d("header",e.languageLabels.Transaction),t(),d("value",e.trData)("scrollDirection","vertical")("scrollable",!0),t(4),d("header",e.languageLabels.Details),t(5),o(e.languageLabels.start_date),t(2),d("value",e.selectedAccount.start_date?I(15,23,e.selectedAccount.start_date,"dd-MM-yyyy"):null),t(5),o(e.languageLabels.maturity_date),t(2),d("value",e.selectedAccount.maturity_date?I(22,26,e.selectedAccount.maturity_date,"dd-MM-yyyy"):null),t(5),o(e.languageLabels.RDAmount),t(2),d("value",e.selectedAccount.deposit_amount?e.selectedAccount.deposit_amount:null),t(4),o(e.languageLabels.Term),t(2),d("value",e.selectedAccount.total_term?e.selectedAccount.total_term:null),t(4),o(e.languageLabels.Interest),t(2),d("value",e.selectedAccount.annual_interest_rate?e.selectedAccount.annual_interest_rate:null),t(4),o(e.languageLabels.nominee_name),t(2),d("value",e.selectedAccount.nominee_data!=null&&e.selectedAccount.nominee_data[0]?e.selectedAccount.nominee_data[0].nominee_name:null),t(4),o(e.languageLabels["Owner Type"]),t(2),d("value",e.selectedAccount.owner_type?e.selectedAccount.owner_type:null),t(4),o(e.languageLabels["Access By"]),t(2),d("value",e.selectedAccount.access_by?e.selectedAccount.access_by:null),t(4),o(e.languageLabels.account_holders),t(2),d("ngForOf",e.selectedAccount.acc_holder_data)}}var pe=class c{constructor(l,e,a,s,m,b,x){this._fb=l;this.route=e;this.http=a;this.api=s;this.ps=m;this.location=b;this.cryptoUrl=x;this.languageLabelData=me}rdForm;comaSaprator;decimalPoints;maxDate;minDate;endDateMinDate;urlProduct;urlAccId;urlBusinessNumber;urlBusinessCode;cifId;cifMobile;productMap={1002:"Share",1003:"Savings",1005:"FD",1006:"RD",1007:"Loan"};accountList=[];accountDisplayLabel="";selectedAccount=[];trData=[];opBalance=0;showTable=!1;currentLanguage;languageLabelData;languageLabels={};ngOnInit(){return L(this,null,function*(){this.createSavingsForm(),this.setEnvLanguage();let l=localStorage.getItem("ledger_client_id");l||(l=crypto.randomUUID(),localStorage.setItem("ledger_client_id",l)),this.route.queryParams.subscribe(e=>L(this,null,function*(){let a=e.t;if(!a){alert("Invalid or missing link");return}let m=yield this.cryptoUrl.decryptToken(a,"69f10c10568abe88bf8374203375a4b6");if(this.cifId=m.cif_id,this.cifMobile=m.cif_mobile,this.urlProduct=Number(m.product),this.urlBusinessNumber=m.businessNumber,this.urlBusinessCode=m.business_code,!this.cifId||!this.urlProduct||!this.urlBusinessNumber||!this.urlBusinessCode){alert("Invalid decrypted data");return}this.validateLedgerAccess(m.token)}))})}validateLedgerAccess(l){let e=localStorage.getItem("ledger_client_id");if(!e){alert("Invalid session");return}this.http.get("http://localhost:8800/whatsAppDemo/api/ledger/validate",{params:{token:l,client_id:e}}).subscribe({next:()=>{this.fetchProductAccounts()},error:a=>{let s=a.error?.reason;alert(s==="expired"?"\u23F1 Link expired. Please open again from WhatsApp.":s==="link_already_used"?"\u274C This link was already used.":"\u274C Invalid link")}})}fetchProductAccounts(){let l={business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"productBalance",cif_mobile:this.cifMobile,cif_id:this.cifId,product:this.urlProduct};this.api.post(E.TRANSCATION,l).subscribe(e=>{let a=e?.payload?.data?.balanceData?.data||e?.data?.balanceData?.data||[];this.accountList=a.map(s=>F(P({},s),{label:`${s.account_no} - ${s.product_name}`}))})}onAccountChange(l){this.urlAccId=l,this.selectedAccount=this.accountList.find(e=>e.id===l)||{},this.accountDisplayLabel=this.selectedAccount.label||"",this.trData=[],this.opBalance=0,this.showTable=!1}setEnvLanguage(){this.ps.getTranslateLang().subscribe(l=>{this.currentLanguage=l,Object.keys(this.languageLabelData.English).forEach(e=>{this.languageLabelData[this.currentLanguage]&&this.languageLabelData[this.currentLanguage][e]&&this.languageLabelData[this.currentLanguage][e]!==""?this.languageLabels[e]=this.languageLabelData[this.currentLanguage][e]:this.languageLabels[e]=this.languageLabelData.English[e]})})}createSavingsForm(){this.rdForm=this._fb.group({acc_id:new T(null,w.required),start_date:new T(null,w.required),end_date:new T(null,w.required)})}changeDate(l){this.rdForm.get("start_date")?.valid&&l=="start_date"&&(this.endDateMinDate=this.rdForm.get("start_date")?.value),this.rdForm.get("start_date")?.valid&&this.rdForm.get("end_date")?.valid&&this.rdForm.get("end_date")?.value<this.rdForm.get("start_date")?.value&&this.rdForm.get("end_date")?.setValue(this.maxDate)}onSubmit(l){let e={acc_id:this.urlAccId,business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"Ledger",product:this.urlProduct,start_date:A(l.value.start_date,"YYYY-MM-DD"),end_date:A(l.value.end_date,"YYYY-MM-DD")};this.api.post(E.TRANSCATION,e).subscribe(a=>{let s=a?.payload?.data;if(this.trData=s?.data||[],this.opBalance=s?.opening||0,this.showTable=!0,this.trData&&this.trData.length>0){let m=this.opBalance;for(let b=this.trData.length-1;b>=0;b--){let x=this.trData[b];x.balance_amount=m+(x.cr_amount-x.dr_amount),m+=x.cr_amount-x.dr_amount}}})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||c)(y(J),y(Y),y(O),y(ce),y(X),y(R),y(se))};static \u0275cmp=M({type:c,selectors:[["app-rd-transaction"]],decls:37,vars:26,consts:[["start_date",""],["end_date",""],["dt1",""],[1,"text-center","pt-2"],[1,"px-3",3,"keydown.enter","submit","formGroup"],[1,"mb-4"],[1,"grid"],[1,"col-6","sm:col-4","md:col-3"],[1,"field","grid"],[1,"col-12","md:col-12"],["appendTo","body","id","start_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","start_date",3,"onSelect","onInput","maxDate","showIcon","showClear","required"],["appendTo","body","id","end_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","end_date",3,"onSelect","onInput","minDate","maxDate","showIcon","showClear","required"],[1,"col-10"],[1,"col-12"],["id","acc_id","styleClass","w-full","appendTo","body","name","acc_id","optionValue","id","optionLabel","label","formControlName","acc_id","placeholder","Select",3,"onChange","options"],[1,"col-2"],["appStopPropagation","",1,"form-save-btn"],["type","submit","pButton","","icon","pi pi-search",1,"p-button-sm",2,"height","2rem",3,"disabled"],[1,"col-3"],[1,"col-4","font-bold","pl-0"],[1,"col-3","font-bold","pl-0"],["class","trans-card",4,"ngIf"],[1,"trans-card"],[3,"header"],["styleClass","p-datatable-gridlines p-datatable-striped","scrollHeight","calc(100vh - var(--pro-header-height) - var(--pro-footer-height) - 340px)",3,"value","scrollDirection","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"grid","px-3"],[1,"col-12","mt-3"],["htmlFor","start_date",1,"col-4","mb-2","md:col-3","md:mb-0"],[1,"col-8","md:col-9"],["pInputText","","id","start_date","disabled","","type","text",3,"value"],["htmlFor","maturity_date",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","maturity_date","disabled","","type","text",3,"value"],["htmlFor","deposit_amount",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","deposit_amount","disabled","","type","text",3,"value"],["htmlFor","total_term",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","total_term","disabled","","type","text",3,"value"],["htmlFor","annual_interest_rate",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","annual_interest_rate","disabled","","type","text",3,"value"],["htmlFor","nominee_name",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","nominee_name","disabled","","type","text",3,"value"],["htmlFor","owner_type",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","owner_type","disabled","","type","text",3,"value"],["htmlFor","access_by",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","access_by","disabled","","type","text",3,"value"],["htmlFor","account_holders",1,"col-4","mb-2","md:col-3","md:mb-0"],["class","text-xs sm:text-sm",4,"ngFor","ngForOf"],[1,"hidden","sm:flex"],["width","20%"],["width","20%",1,"text-right"],[1,"flex","sm:hidden"],["width","50%",2,"border-right","none"],["width","50%",2,"border-left","none"],[1,"text-right"],[2,"color","green"],[2,"color","red"],["style","color: green","class","text-right",4,"ngIf"],["style","color: red","class","text-right",4,"ngIf"],[1,"text-xs","text-right"],[1,"text-right",2,"color","green"],[1,"text-right",2,"color","red"],[1,"text-xs","sm:text-sm"]],template:function(e,a){if(e&1){let s=B();i(0,"div",3)(1,"h1"),r(2),n()(),i(3,"form",4),S("keydown.enter",function(b){return g(s),h(b.preventDefault())})("submit",function(){return g(s),h(a.onSubmit(a.rdForm))}),i(4,"div",5)(5,"p-card")(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"p-datepicker",10,0),S("onSelect",function(){return g(s),h(a.changeDate("start_date"))})("onInput",function(){return g(s),h(a.changeDate("start_date"))}),n()()()(),i(12,"div",7)(13,"div",8)(14,"div",9)(15,"p-datepicker",11,1),S("onSelect",function(){return g(s),h(a.changeDate("end_date"))})("onInput",function(){return g(s),h(a.changeDate("end_date"))}),n()()()(),i(17,"div",12)(18,"div",8)(19,"div",13)(20,"p-dropdown",14),S("onChange",function(b){return g(s),h(a.onAccountChange(b.value))}),n()()()(),i(21,"div",15)(22,"div",16),_(23,"button",17),n()(),i(24,"div",13)(25,"div",6)(26,"div",18),r(27),n(),i(28,"div",19),r(29),p(30,"dynamicDecimal"),n(),i(31,"div",15),r(32),n(),i(33,"div",20),r(34),p(35,"dynamicDecimal"),n()()()()()(),D(36,he,65,29,"p-card",21),n()}e&2&&(t(2),o(a.languageLabels.RD),t(),d("formGroup",a.rdForm),t(7),d("maxDate",a.maxDate)("showIcon",!0)("showClear",!0)("required",!0),t(5),d("minDate",a.endDateMinDate)("maxDate",a.maxDate)("showIcon",!0)("showClear",!0)("required",!0),t(5),d("options",a.accountList),t(3),d("disabled",a.rdForm.invalid),t(4),u("",a.languageLabels.Balance,":"),t(2),u(" ",v(30,18,a.selectedAccount.account_balance_derived?a.selectedAccount.account_balance_derived:0,a.decimalPoints,a.comaSaprator)," "),t(3),u("",a.languageLabels.Hold,":"),t(2),u(" ",v(35,22,a.selectedAccount.total_amount_on_hold?a.selectedAccount.total_amount_on_hold:0,a.decimalPoints,a.comaSaprator)," "),t(2),d("ngIf",a.showTable))},dependencies:[de,k,N,j,q,te,ae,Q,ne,le,re,$,H,G,z,U,W,ie,ee,K,Z,V,oe],styles:["[_nghost-%COMP%]     .p-card .p-card-content{padding:0}[_nghost-%COMP%]     .trans-card .p-card .p-card-body{padding:0}[_nghost-%COMP%]     .p-tabview .p-tabview-nav{display:flex;justify-content:space-between}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li{flex:1;text-align:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{justify-content:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li:last-child{border-right:none;border-top-right-radius:4px}[_nghost-%COMP%]     .p-tabview .p-tabview-panels{padding:0}[_nghost-%COMP%]     .p-disabled, .p-component[_ngcontent-%COMP%]:disabled{opacity:1}[_nghost-%COMP%]     .p-tabview .p-datatable .p-datatable-thead>tr>th{background:#f8f8ff}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{color:#000}[_nghost-%COMP%]     .list-card .p-datatable .p-datatable-tbody>tr>td{border:1px solid black;border-width:0 0 1px 0}"]})};export{pe as RDTransactionComponent};
