import{a as F,b as me}from"./chunk-GL5CNTKD.js";import{a as E,b as de,c as ce}from"./chunk-V7EBA6X5.js";import{$ as te,A as q,B as H,D as w,E as G,G as $,H as U,I as W,K as z,O as J,P as K,V as Q,X,Y as Z,Z as ee,a as V,aa as ae,ba as ie,ca as ne,da as le,fa as re,ga as oe,i as Y,q as R,s as j,z as C}from"./chunk-4HOK7LM6.js";import{$c as k,Cb as d,Lb as a,Mb as i,Nb as u,Rb as M,Tb as S,Ub as y,Xc as B,a as L,ad as N,b as A,bb as t,cb as h,dc as l,ec as o,fc as _,gc as I,gd as O,h as T,nb as P,oa as b,pa as g,ub as x,vc as p,xc as f,yc as v}from"./chunk-HV3O5WE3.js";function pe(c,r){if(c&1&&(a(0,"tr",54)(1,"th",55),l(2),i(),a(3,"th",55),l(4),i(),a(5,"th",56),l(6),i(),a(7,"th",56),l(8),i(),a(9,"th",56),l(10),i()(),a(11,"tr",57)(12,"th",58)(13,"div"),l(14),i(),a(15,"div"),l(16),i()(),a(17,"th",59)(18,"div",60)(19,"span",61),l(20),i(),l(21,"/"),a(22,"span",62),l(23),i()(),a(24,"div",60),l(25),i()()()),c&2){let e=y(2);t(2),o(e.languageLabels.Date),t(2),o(e.languageLabels.Remarks),t(2),_(" ",e.languageLabels.Credit," "),t(2),_(" ",e.languageLabels.Debit," "),t(2),_(" ",e.languageLabels.Balance," "),t(4),o(e.languageLabels.Date),t(2),o(e.languageLabels.Remarks),t(4),o(e.languageLabels.Credit),t(3),o(e.languageLabels.Debit),t(2),o(e.languageLabels.Balance)}}function ue(c,r){if(c&1&&(a(0,"div",66),l(1),p(2,"dynamicDecimal"),i()),c&2){let e=y().$implicit,n=y(2);t(),_(" ",v(2,1,e.cr_amount,n.decimalPoints,n.comaSaprator)," ")}}function _e(c,r){if(c&1&&(a(0,"div",67),l(1),p(2,"dynamicDecimal"),i()),c&2){let e=y().$implicit,n=y(2);t(),_(" ",v(2,1,e.dr_amount,n.decimalPoints,n.comaSaprator)," ")}}function ve(c,r){if(c&1&&(a(0,"tr",54)(1,"td",55),l(2),p(3,"date"),i(),a(4,"td",55),l(5),i(),a(6,"td",56),l(7),p(8,"dynamicDecimal"),i(),a(9,"td",56),l(10),p(11,"dynamicDecimal"),i(),a(12,"td",56),l(13),p(14,"dynamicDecimal"),i()(),a(15,"tr",57)(16,"td",58)(17,"div"),l(18),p(19,"date"),i(),a(20,"div"),l(21),i()(),a(22,"td",59),x(23,ue,3,5,"div",63)(24,_e,3,5,"div",64),a(25,"div",65),l(26),p(27,"dynamicDecimal"),i()()()),c&2){let e=r.$implicit,n=y(2);t(2),o(f(3,12,e.date1,"dd-MM-yyyy")),t(3),o(e.remarks),t(2),_(" ",e.cr_amount>0?v(8,15,e.cr_amount,n.decimalPoints,n.comaSaprator):""," "),t(3),_(" ",e.dr_amount>0?v(11,19,e.dr_amount,n.decimalPoints,n.comaSaprator):""," "),t(3),I(" ",v(14,23,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),n.decimalPoints,n.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," "),t(5),o(f(19,27,e.date1,"dd-MM-yyyy")),t(3),o(e.remarks),t(2),d("ngIf",e.cr_amount!=0),t(),d("ngIf",e.dr_amount!=0),t(2),I(" ",v(27,30,(e==null?null:e.balance_amount)>=0?e==null?null:e.balance_amount:-(e==null?null:e.balance_amount),n.decimalPoints,n.comaSaprator),"",(e==null?null:e.balance_amount)>0?" CR":" DR"," ")}}function be(c,r){if(c&1&&(a(0,"div",68),l(1),i()),c&2){let e=r.$implicit,n=r.index;t(),I(" ",n+1+". "," ",e.display_name," ")}}function ge(c,r){if(c&1&&(a(0,"p-card",22)(1,"p-tabView")(2,"p-tabPanel",23)(3,"p-table",24,2),x(5,pe,26,10,"ng-template",25)(6,ve,28,34,"ng-template",26),i()(),a(7,"p-tabPanel",23)(8,"div",27)(9,"div",28)(10,"div",8)(11,"label",29),l(12),i(),a(13,"div",30),u(14,"input",31),i()()(),a(15,"div",13)(16,"div",8)(17,"label",32),l(18),i(),a(19,"div",30),u(20,"input",33),i()()(),a(21,"div",13)(22,"div",8)(23,"label",34),l(24),i(),a(25,"div",30),u(26,"input",35),p(27,"date"),i()()(),a(28,"div",13)(29,"div",8)(30,"label",36),l(31),i(),a(32,"div",30),u(33,"input",37),p(34,"date"),i()()(),a(35,"div",13)(36,"div",8)(37,"label",38),l(38),i(),a(39,"div",30),u(40,"input",39),i()()(),a(41,"div",13)(42,"div",8)(43,"label",40),l(44),i(),a(45,"div",30),u(46,"input",41),i()()(),a(47,"div",13)(48,"div",8)(49,"label",42),l(50),i(),a(51,"div",30),u(52,"input",43),p(53,"date"),i()()(),a(54,"div",13)(55,"div",8)(56,"label",44),l(57),i(),a(58,"div",30),u(59,"input",45),i()()(),a(60,"div",13)(61,"div",8)(62,"label",46),l(63),i(),a(64,"div",30),u(65,"input",47),i()()(),a(66,"div",13)(67,"div",8)(68,"label",48),l(69),i(),a(70,"div",30),u(71,"input",49),i()()(),a(72,"div",13)(73,"div",8)(74,"label",50),l(75),i(),a(76,"div",30),u(77,"input",51),i()()(),a(78,"div",13)(79,"div",8)(80,"label",52),l(81),i(),a(82,"div",30),x(83,be,2,2,"div",53),i()()()()()()()),c&2){let e=y();t(2),d("header",e.languageLabels.Transaction),t(),d("value",e.trData)("scrollDirection","vertical")("scrollable",!0),t(4),d("header",e.languageLabels.Details),t(5),o(e.languageLabels.fdr_no),t(2),d("value",e.selectedAccount.fdr_number?e.selectedAccount.fdr_number:null),t(4),o(e.languageLabels.deposit_amount),t(2),d("value",e.selectedAccount.deposit_amount?e.selectedAccount.deposit_amount:null),t(4),o(e.languageLabels.fd_date),t(2),d("value",e.selectedAccount.fd_date?f(27,29,e.selectedAccount.fd_date,"dd-MM-yyyy"):null),t(5),o(e.languageLabels.as_on_date),t(2),d("value",e.selectedAccount.as_on_date?f(34,32,e.selectedAccount.as_on_date,"dd-MM-yyyy"):null),t(5),o(e.languageLabels.Interest),t(2),d("value",e.selectedAccount.annual_interest_rate?e.selectedAccount.annual_interest_rate:null),t(4),o(e.languageLabels.Term),t(2),d("value",e.selectedAccount.deposit_term?e.selectedAccount.deposit_term:null),t(4),o(e.languageLabels.maturity_date),t(2),d("value",e.selectedAccount.maturity_date?f(53,35,e.selectedAccount.maturity_date,"dd-MM-yyyy"):null),t(5),o(e.languageLabels.maturity_amount),t(2),d("value",e.selectedAccount.maturity_amt?e.selectedAccount.maturity_amt:null),t(4),o(e.languageLabels.nominee_name),t(2),d("value",e.selectedAccount.nominee_data!=null&&e.selectedAccount.nominee_data[0]?e.selectedAccount.nominee_data[0].nominee_name:null),t(4),o(e.languageLabels["Owner Type"]),t(2),d("value",e.selectedAccount.owner_type?e.selectedAccount.owner_type:null),t(4),o(e.languageLabels["Access By"]),t(2),d("value",e.selectedAccount.access_by?e.selectedAccount.access_by:null),t(4),o(e.languageLabels.account_holders),t(2),d("ngForOf",e.selectedAccount.acc_holder_data)}}var se=class c{constructor(r,e,n,m,s,D,he){this._fb=r;this.api=e;this.http=n;this.cryptoUrl=m;this.route=s;this.ps=D;this.location=he;this.languageLabelData=me}fdForm;comaSaprator;decimalPoints;maxDate;endDateMinDate;urlProduct;urlAccId;urlBusinessNumber;urlBusinessCode;cifId;cifMobile;productMap={1002:"Share",1003:"Savings",1005:"FD",1006:"RD",1007:"Loan"};accountList=[];selectedAccount={};accountDisplayLabel="";trData=[];opBalance=0;showTable=!1;currentLanguage;languageLabelData;languageLabels={};ngOnInit(){return T(this,null,function*(){this.createSavingsForm(),this.setEnvLanguage();let r=localStorage.getItem("ledger_client_id");r||(r=crypto.randomUUID(),localStorage.setItem("ledger_client_id",r)),this.route.queryParams.subscribe(e=>T(this,null,function*(){let n=e.t;if(!n){alert("Invalid or missing link");return}let s=yield this.cryptoUrl.decryptToken(n,"69f10c10568abe88bf8374203375a4b6");if(console.log("payload",s),this.cifId=s.cif_id,this.cifMobile=s.cif_mobile,this.urlProduct=Number(s.product),this.urlBusinessNumber=s.businessNumber,this.urlBusinessCode=s.business_code,!this.cifId||!this.urlProduct||!this.urlBusinessNumber||!this.urlBusinessCode){alert("Invalid decrypted data");return}this.validateLedgerAccess(s.token)}))})}validateLedgerAccess(r){let e=localStorage.getItem("ledger_client_id");if(!e){alert("Invalid session");return}this.http.get("http://localhost:8800/whatsAppDemo/api/ledger/validate",{params:{token:r,client_id:e}}).subscribe({next:()=>{this.fetchProductAccounts()},error:n=>{let m=n.error?.reason;alert(m==="expired"?"\u23F1 Link expired. Please open again from WhatsApp.":m==="link_already_used"?"\u274C This link was already used.":"\u274C Invalid link")}})}fetchProductAccounts(){let r={business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"productBalance",cif_mobile:this.cifMobile,cif_id:this.cifId,product:this.urlProduct};this.api.post(E.TRANSCATION,r).subscribe(e=>{let n=e?.payload?.data?.balanceData?.data||e?.data?.balanceData?.data||[];this.accountList=n.map(m=>A(L({},m),{label:`${m.account_no} - ${m.product_name}`}))})}onAccountChange(r){this.urlAccId=r,this.selectedAccount=this.accountList.find(e=>e.id===r)||{},this.accountDisplayLabel=this.selectedAccount.label||"",this.trData=[],this.opBalance=0,this.showTable=!1}createSavingsForm(){this.fdForm=this._fb.group({acc_id:new w(null,C.required),start_date:new w(null,C.required),end_date:new w(null,C.required)})}changeDate(r){this.fdForm.get("start_date")?.valid&&r==="start_date"&&(this.endDateMinDate=this.fdForm.get("start_date")?.value)}onSubmit(r){let e={acc_id:this.urlAccId,business_number:this.urlBusinessNumber,business_code:this.urlBusinessCode,option_selection:"Ledger",product:this.urlProduct,start_date:F(r.value.start_date,"YYYY-MM-DD"),end_date:F(r.value.end_date,"YYYY-MM-DD")};this.api.post(E.TRANSCATION,e).subscribe(n=>{let m=n?.payload?.data;this.trData=m?.data||[],this.opBalance=m?.opening||0,this.showTable=!0})}setEnvLanguage(){this.ps.getTranslateLang().subscribe(r=>{this.currentLanguage=r,Object.keys(this.languageLabelData.English).forEach(e=>{this.languageLabels[e]=this.languageLabelData[this.currentLanguage]?.[e]||this.languageLabelData.English[e]})})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||c)(h(z),h(de),h(V),h(ce),h(Y),h(Q),h(B))};static \u0275cmp=P({type:c,selectors:[["app-fd-transaction"]],decls:37,vars:26,consts:[["start_date",""],["end_date",""],["dt1",""],[1,"text-center","pt-2"],[1,"px-3",3,"keydown.enter","submit","formGroup"],[1,"mb-4"],[1,"grid"],[1,"col-6","sm:col-4","md:col-3"],[1,"field","grid"],[1,"col-12","md:col-12"],["appendTo","body","id","start_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","start_date",3,"onSelect","onInput","maxDate","showIcon","showClear","required"],["appendTo","body","id","end_date","styleClass","w-full","dateFormat","dd-mm-yy","placeholder","DD-MM-YYYY","formControlName","end_date",3,"onSelect","onInput","minDate","maxDate","showIcon","showClear","required"],[1,"col-10"],[1,"col-12"],["id","acc_id","styleClass","w-full","appendTo","body","name","acc_id","optionValue","id","optionLabel","label","formControlName","acc_id","placeholder","Select",3,"onChange","options"],[1,"col-2"],["appStopPropagation","",1,"form-save-btn"],["type","submit","pButton","","icon","pi pi-search",1,"p-button-sm",2,"height","2rem",3,"disabled"],[1,"col-3"],[1,"col-4","font-bold","pl-0"],[1,"col-3","font-bold","pl-0"],["class","trans-card",4,"ngIf"],[1,"trans-card"],[3,"header"],["styleClass","p-datatable-gridlines p-datatable-striped","scrollHeight","calc(100vh - var(--pro-header-height) - var(--pro-footer-height) - 340px)",3,"value","scrollDirection","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"grid","px-3"],[1,"col-12","mt-3"],["htmlFor","fdr_no",1,"col-4","mb-2","md:col-3","md:mb-0"],[1,"col-8","md:col-9"],["pInputText","","id","fdr_no","disabled","","type","text",3,"value"],["htmlFor","deposit_amount",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","deposit_amount","disabled","","type","text",3,"value"],["htmlFor","fd_date",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","fd_date","disabled","","type","text",3,"value"],["htmlFor","as_on_date",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","as_on_date","disabled","","type","text",3,"value"],["htmlFor","annual_interest_rate",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","annual_interest_rate","disabled","","type","text",3,"value"],["htmlFor","total_term",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","total_term","disabled","","type","text",3,"value"],["htmlFor","maturity_date",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","maturity_date","disabled","","type","text",3,"value"],["htmlFor","maturity_amount",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","maturity_amount","disabled","","type","text",3,"value"],["htmlFor","nominee_name",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","nominee_name","disabled","","type","text",3,"value"],["htmlFor","owner_type",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","owner_type","disabled","","type","text",3,"value"],["htmlFor","access_by",1,"col-4","mb-2","md:col-3","md:mb-0"],["pInputText","","id","access_by","disabled","","type","text",3,"value"],["htmlFor","account_holders",1,"col-4","mb-2","md:col-3","md:mb-0"],["class","text-xs sm:text-sm",4,"ngFor","ngForOf"],[1,"hidden","sm:flex"],["width","20%"],["width","20%",1,"text-right"],[1,"flex","sm:hidden"],["width","50%",2,"border-right","none"],["width","50%",2,"border-left","none"],[1,"text-right"],[2,"color","green"],[2,"color","red"],["style","color: green","class","text-right",4,"ngIf"],["style","color: red","class","text-right",4,"ngIf"],[1,"text-xs","text-right"],[1,"text-right",2,"color","green"],[1,"text-right",2,"color","red"],[1,"text-xs","sm:text-sm"]],template:function(e,n){if(e&1){let m=M();a(0,"div",3)(1,"h1"),l(2),i()(),a(3,"form",4),S("keydown.enter",function(D){return b(m),g(D.preventDefault())})("submit",function(){return b(m),g(n.onSubmit(n.fdForm))}),a(4,"div",5)(5,"p-card")(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"p-datepicker",10,0),S("onSelect",function(){return b(m),g(n.changeDate("start_date"))})("onInput",function(){return b(m),g(n.changeDate("start_date"))}),i()()()(),a(12,"div",7)(13,"div",8)(14,"div",9)(15,"p-datepicker",11,1),S("onSelect",function(){return b(m),g(n.changeDate("end_date"))})("onInput",function(){return b(m),g(n.changeDate("end_date"))}),i()()()(),a(17,"div",12)(18,"div",8)(19,"div",13)(20,"p-dropdown",14),S("onChange",function(D){return b(m),g(n.onAccountChange(D.value))}),i()()()(),a(21,"div",15)(22,"div",16),u(23,"button",17),i()(),a(24,"div",13)(25,"div",6)(26,"div",18),l(27),i(),a(28,"div",19),l(29),p(30,"dynamicDecimal"),i(),a(31,"div",15),l(32),i(),a(33,"div",20),l(34),p(35,"dynamicDecimal"),i()()()()()(),x(36,ge,84,38,"p-card",21),i()}e&2&&(t(2),o(n.languageLabels.FD),t(),d("formGroup",n.fdForm),t(7),d("maxDate",n.maxDate)("showIcon",!0)("showClear",!0)("required",!0),t(5),d("minDate",n.endDateMinDate)("maxDate",n.maxDate)("showIcon",!0)("showClear",!0)("required",!0),t(5),d("options",n.accountList),t(3),d("disabled",n.fdForm.invalid),t(4),_("",n.languageLabels.Balance,":"),t(2),_(" ",v(30,18,n.selectedAccount.FDBalance?n.selectedAccount.FDBalance:0,n.decimalPoints,n.comaSaprator)," "),t(3),_("",n.languageLabels.Hold,":"),t(2),_(" ",v(35,22,n.selectedAccount.total_amount_on_hold?n.selectedAccount.total_amount_on_hold:0,n.decimalPoints,n.comaSaprator)," "),t(2),d("ngIf",n.showTable))},dependencies:[oe,k,N,R,j,ee,te,K,ie,le,ne,G,q,H,W,$,U,ae,Z,J,X,O,re],styles:["[_nghost-%COMP%]     .p-card .p-card-content{padding:0}[_nghost-%COMP%]     .trans-card .p-card .p-card-body{padding:0}[_nghost-%COMP%]     .p-tabview .p-tabview-nav{display:flex;justify-content:space-between}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li{flex:1;text-align:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li .p-tabview-nav-link{justify-content:center}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li:last-child{border-right:none;border-top-right-radius:4px}[_nghost-%COMP%]     .p-tabview .p-tabview-panels{padding:0}[_nghost-%COMP%]     .p-disabled, .p-component[_ngcontent-%COMP%]:disabled{opacity:1}[_nghost-%COMP%]     .p-tabview .p-datatable .p-datatable-thead>tr>th{background:#f8f8ff}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{color:#000}[_nghost-%COMP%]     .list-card .p-datatable .p-datatable-tbody>tr>td{border:1px solid black;border-width:0 0 1px 0}"]})};export{se as FDTransactionComponent};
