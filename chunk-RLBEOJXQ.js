import{$ as D,Ab as O,C as N,D as b,F as y,H as m,I as u,J as h,P as p,Q as A,V as R,Z as g,a as M,ca as S,fa as U,ha as T,ja as F,n as C,s as k,t as w,u as P,ua as W,xb as j,y as c,za as _}from"./chunk-HV3O5WE3.js";var v="Service workers are disabled or not supported by this browser";function B(t){return b(()=>P(new Error(t)))}var d=class{serviceWorker;worker;registration;events;constructor(r){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=B(v);else{let n=y(r,"controllerchange").pipe(c(()=>r.controller)),i=b(()=>w(r.controller)),o=N(i,n);this.worker=o.pipe(h(l=>!!l)),this.registration=this.worker.pipe(g(()=>r.getRegistration()));let I=y(r,"message").pipe(c(l=>l.data)).pipe(h(l=>l&&l.type)).pipe(R());I.connect(),this.events=I}}postMessage(r,e){return this.worker.pipe(p(1),D(n=>{n.postMessage(M({action:r},e))})).toPromise().then(()=>{})}postMessageWithOperation(r,e,n){let i=this.waitForOperationCompleted(n),o=this.postMessage(r,e);return Promise.all([o,i]).then(([,s])=>s)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=n=>n.type===r:e=n=>r.includes(n.type),this.events.pipe(h(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(p(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe(h(e=>e.nonce===r),p(1),c(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},K=(()=>{class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new C;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=u,this.notificationClicks=u,this.subscription=u;return}this.messages=this.sw.eventsOfType("PUSH").pipe(c(i=>i.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(c(i=>i.data)),this.pushManager=this.sw.registration.pipe(c(i=>i.pushManager));let n=this.pushManager.pipe(g(i=>i.getSubscription()));this.subscription=m(n,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(v));let n={userVisibleOnly:!0},i=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(i.length));for(let s=0;s<i.length;s++)o[s]=i.charCodeAt(s);return n.applicationServerKey=o,this.pushManager.pipe(g(s=>s.subscribe(n)),p(1)).toPromise().then(s=>(this.subscriptionChanges.next(s),s))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(v));let e=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(i=>{if(!i)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(p(1),g(e)).toPromise()}decodeBase64(e){return atob(e)}static \u0275fac=function(n){return new(n||t)(T(d))};static \u0275prov=S({token:t,factory:t.\u0275fac})}return t})(),x=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=u,this.unrecoverable=u;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(v));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(v));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(n){return new(n||t)(T(d))};static \u0275prov=S({token:t,factory:t.\u0275fac})}return t})();var L=new U("");function Z(t,r,e){return()=>{if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let n=t.get(_),i=t.get(O);n.runOutsideAngular(()=>{let s=navigator.serviceWorker,a=()=>s.controller?.postMessage({action:"INITIALIZE"});s.addEventListener("controllerchange",a),i.onDestroy(()=>{s.removeEventListener("controllerchange",a)})});let o;if(typeof e.registrationStrategy=="function")o=e.registrationStrategy();else{let[s,...a]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(s){case"registerImmediately":o=w(null);break;case"registerWithDelay":o=V(+a[0]||0);break;case"registerWhenStable":let E=k(t.get(O).whenStable());o=a[0]?m(E,V(+a[0])):E;break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}n.runOutsideAngular(()=>o.pipe(p(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:e.scope}).catch(s=>console.error("Service worker registration failed with:",s))))}}function V(t){return w(null).pipe(A(t))}function $(t){return new d(t.enabled!==!1?navigator.serviceWorker:void 0)}var f=class{enabled;scope;registrationStrategy};function ee(t,r={}){return F([K,x,{provide:L,useValue:t},{provide:f,useValue:r},{provide:d,useFactory:$,deps:[f]},{provide:j,useFactory:Z,deps:[W,L,f],multi:!0}])}export{x as a,ee as b};
